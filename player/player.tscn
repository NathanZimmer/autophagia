[gd_scene load_steps=26 format=3 uid="uid://dnhp4dcugklq6"]

[ext_resource type="Script" uid="uid://c1o8i6ob4hruq" path="res://player/player.gd" id="1_y2fp8"]
[ext_resource type="Environment" uid="uid://cbgre4uktxw6d" path="res://common/main_world_env.tres" id="2_xgxvm"]
[ext_resource type="Script" uid="uid://ck2srl31dxoy2" path="res://player/player_raycast_3d.gd" id="4_8t03j"]
[ext_resource type="PackedScene" uid="uid://cjew08elm562t" path="res://gui/gui.tscn" id="5_boad6"]
[ext_resource type="Material" uid="uid://byvayr8jwcepu" path="res://player/materials/retro_filter.tres" id="8_hg6s5"]
[ext_resource type="Script" uid="uid://bnbt62ete8km4" path="res://player/inventory.gd" id="8_rgyib"]
[ext_resource type="Animation" uid="uid://3iekuyht51r3" path="res://assets/player/animations/camera_sway.res" id="9_ebec5"]
[ext_resource type="Script" uid="uid://clawryrmh60wq" path="res://player/message_handler.gd" id="10_8t03j"]
[ext_resource type="Animation" uid="uid://ds2ipytexoe1q" path="res://assets/player/animations/camera_impact.res" id="10_yllr7"]
[ext_resource type="Animation" uid="uid://djrqyxbnoaicn" path="res://assets/player/animations/camera_reset.res" id="11_kb6p2"]
[ext_resource type="Script" uid="uid://c7vyaxwgerejy" path="res://player/camera_animation_tree.gd" id="12_ebec5"]
[ext_resource type="AudioStream" uid="uid://bnji7bs7grmhs" path="res://assets/player/sound/footstep_2.wav" id="14_wodsf"]

[sub_resource type="CameraAttributesPractical" id="CameraAttributesPractical_4juu5"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_8l6i1"]
radius = 0.3

[sub_resource type="CapsuleMesh" id="CapsuleMesh_dgi16"]
radius = 0.3

[sub_resource type="AnimationLibrary" id="AnimationLibrary_2ieo8"]

[sub_resource type="AnimationLibrary" id="AnimationLibrary_wodsf"]
_data = {
&"RESET": ExtResource("11_kb6p2"),
&"impact": ExtResource("10_yllr7"),
&"sway": ExtResource("9_ebec5")
}

[sub_resource type="AnimationNodeBlend2" id="AnimationNodeBlend2_yllr7"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_kb6p2"]
animation = &"player_camera/impact"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_ebec5"]
mix_mode = 1
break_loop_at_end = true

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_32hag"]
animation = &"player_camera/RESET"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ebec5"]
animation = &"player_camera/sway"

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_ebec5"]

[sub_resource type="AnimationNodeTimeSeek" id="AnimationNodeTimeSeek_ebec5"]

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_ebec5"]
graph_offset = Vector2(-375.324, -186.138)
nodes/BlendWalk/node = SubResource("AnimationNodeBlend2_yllr7")
nodes/BlendWalk/position = Vector2(400, -140)
nodes/Impact/node = SubResource("AnimationNodeAnimation_kb6p2")
nodes/Impact/position = Vector2(340, 120)
nodes/OneShotImpact/node = SubResource("AnimationNodeOneShot_ebec5")
nodes/OneShotImpact/position = Vector2(600, -60)
nodes/RESET/node = SubResource("AnimationNodeAnimation_32hag")
nodes/RESET/position = Vector2(80, 0)
nodes/Sway/node = SubResource("AnimationNodeAnimation_ebec5")
nodes/Sway/position = Vector2(-240, -160)
nodes/TimeScaleSway/node = SubResource("AnimationNodeTimeScale_ebec5")
nodes/TimeScaleSway/position = Vector2(180, -180)
nodes/TimeSeekSway/node = SubResource("AnimationNodeTimeSeek_ebec5")
nodes/TimeSeekSway/position = Vector2(20, -180)
nodes/output/position = Vector2(820, -40)
node_connections = [&"BlendWalk", 0, &"RESET", &"BlendWalk", 1, &"TimeScaleSway", &"OneShotImpact", 0, &"BlendWalk", &"OneShotImpact", 1, &"Impact", &"TimeScaleSway", 0, &"TimeSeekSway", &"TimeSeekSway", 0, &"Sway", &"output", 0, &"OneShotImpact"]

[node name="Player" type="CharacterBody3D" groups=["player"]]
script = ExtResource("1_y2fp8")

[node name="Camera3D" type="Camera3D" parent="."]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.7, 0)
cull_mask = 1047539
environment = ExtResource("2_xgxvm")
attributes = SubResource("CameraAttributesPractical_4juu5")
current = true
fov = 90.0
far = 400.0

[node name="PlayerRayCast3D" type="RayCast3D" parent="Camera3D"]
target_position = Vector3(0, 0, -2)
collide_with_areas = true
script = ExtResource("4_8t03j")
metadata/_custom_type_script = "uid://ck2srl31dxoy2"

[node name="MessageHandler" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("10_8t03j")
metadata/_custom_type_script = "uid://clawryrmh60wq"

[node name="Inventory" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("8_rgyib")
metadata/_custom_type_script = "uid://bnbt62ete8km4"

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Gui" parent="CanvasLayer" node_paths=PackedStringArray("_crosshair_raycast") instance=ExtResource("5_boad6")]
_crosshair_raycast = NodePath("../../Camera3D/PlayerRayCast3D")

[node name="RetroFilter" type="ColorRect" parent="CanvasLayer"]
process_mode = 3
material = ExtResource("8_hg6s5")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
unique_name_in_owner = true
shape = SubResource("CapsuleShape3D_8l6i1")

[node name="Body" type="MeshInstance3D" parent="."]
layers = 512
cast_shadow = 0
gi_mode = 0
mesh = SubResource("CapsuleMesh_dgi16")
skeleton = NodePath("")

[node name="Footsteps" type="AudioStreamPlayer3D" parent="."]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0)
stream = ExtResource("14_wodsf")
volume_db = 3.0
max_db = 6.0
max_polyphony = 3
bus = &"Game"

[node name="CameraAnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_2ieo8"),
&"player_camera": SubResource("AnimationLibrary_wodsf")
}

[node name="CameraAnimationTree" type="AnimationTree" parent="."]
unique_name_in_owner = true
root_node = NodePath("%CameraAnimationTree/..")
tree_root = SubResource("AnimationNodeBlendTree_ebec5")
anim_player = NodePath("../CameraAnimationPlayer")
parameters/BlendWalk/blend_amount = 0.0
parameters/OneShotImpact/active = false
parameters/OneShotImpact/internal_active = false
parameters/OneShotImpact/request = 0
parameters/TimeScaleSway/scale = 1.0
parameters/TimeSeekSway/seek_request = -1.0
script = ExtResource("12_ebec5")
